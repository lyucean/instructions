# Регламент работы с Git-ветками

## Структура веток

* `master` - главная ветка, находящаяся всегда рабочем состоянии.
* `develop` - ветка содержащая все последние изменения для релиза.
    * Ответвляется от `master` и сливается обратно в `master` во время выпуска релиза.
* `feature` - ветки для разработки нового функционала и доработки существующего.
    * Ответвляются от `develop` и сливаются обратно в `develop`.
    * Именуются `feature/123-name-of-the-branch`, где `feature/` обязательный префикс, `123` номер задачи, `-name-of-the-branch` имя ветки кратко и емко отражающее суть задачи, на английском языке в нижнем регистре.
* `bugfix` - ветки для внесения исправлений.
    * Ответвляются от `develop`. Сливаются обратно в `develop`.
    * Именуются, `bugfix/name-of-the-branch`, где `bugfix/` обязательный префикс, а название ветки в зависимости от вида ошибки
        * Ошибки из setnry.io записываем в формате `bugfix/sentry2232384385`, где `2232384385` - это номер issue
        * Остальные ошибки (из логов, чатов и тп) именуем `bugfix/short-error-description`, где `short-error-description` имя ветки кратко и емко отражающее суть проблемы, на английском языке в нижнем регистре. Например, `Argument 1 passed to ModelFinanceCheckPrintingReal::prepareProduct() must be of the type array, null given, called in /var/www/esh-derevenskoe.ru/admin/model/finance/check_printing_real.php on line 891` → `bugfix/must-be-type-array-891`
    * Главное отличие от `feature` в том, что `bugfix` не требует тестирования и отдельной для себя задачи.

## Начало работы

* Переключится на локальную ветку develop
```
#!ssh

git checkout develop
```
* Подтянуть все последние изменения из origin/develop
```
#!ssh

git pull
```
* Создать новую ветку для работы над задачей
```
#!ssh

git checkout -b feature/1340-replace-404
```

## Комиты

Изменения в ветке отражаются комитами. Комментарий к комиту должен емко отражать суть изменений. Обязательна к прочтению [статья о написании комментариев к комитам](Написании_комментариев_к_комитам.md). Так же все изменения в рамках работы над задачей необходимо максимально декомпозировать, при этом стараться чтобы комит ничего не ломал. Незабываем пушить в репозиторий нашу ветку, хотя бы раз в сутки, дабы не потерять наработки вместе с рабочей машиной.

В комментарии к комиту обязательно указать ссылку на задачу. В данный момент используется битрикс24 и ссылки добавляются в текст комментария к комиту в следующем формате: `b24-dev-номер_задачи` (для задач в проекте `Разработка`), `b24-1c-номер_задачи` (для задач в проекте по 1С), `b24-номер_задачи` (для задач вне проекта)

Например, по задаче добавили функционал в карточке товара. Для этого была создана миграция, добавлен метод, внесены изменения в существующие методы, один метод переименован. Список комитов с комментариями может выглядеть следующим образом:

1. `добавляет миграцию с новым полем oc_product.some_field`, будет содержать 1 файл с миграцией.
1. `psr-12`, будет содержать файл с форматированием кода в рамках изменяемой области, см. [стиль оформления кода](Стиль_оформления_кода.md).
1. `добавляет метод ModelCatalogProduct::updateSomeFiled()`, будет содержать 1 файл в который добавлен метод.
1. `добавляет редактирование поля oc_product.some_field в методе ModelCatalogProduct::updateProduct()`, будет содержать файл в который внесены изменения.
1. `добавляет вывод поля oc_product.some_field в карточке товара`, будет содержать файл с моделью, в которой указано поле в выборке, файл с контроллером, который это поле передаст в представление и файл представления, в котором будет выведено значение этого поля.
1. `переименовывает метод ModelCatalogProduct::checkProductHasFreezes в ModelCatalogProduct::isFrezes`, будет содержать изменения объединенные по смыслу: файл в котором переименован метод и файлы в которых этот метод использовался. Не стоит сюда помещать дополнительную логику.

## Запрещается

* Внесение изменений не связанных с задачей

*Решение:* оставьте TODO, внесите пометку в список тех.долга, внесите изменения в рамках отдельной задачи.

* Форматирование кода всего файла

*Решение:* форматирование кода в рамках изменяемой области, см. [стиль оформления кода](Стиль_оформления_кода.md).

* Обобщенные комиты

*Решение:* разделять комиты по смыслу, см. пример из работы с веткой.

* Комиты содержащие форматирование кода совместно с внесением изменений

*Решение:* первый комит содержит форматирование в рамках изменяемой области, следующие комиты непосредственно изменения.